import sys
import os
from decouple import config

if not os.path.exists(".env"):
    print(
        ".env file not found."
        "You may create one from 'same-env.txt'."
    )
    sys.exit(1)

OPENAPI_STUB_DIR = config('OPENAPI_STUB_DIR', default='swagger_server')

if not os.path.exists(OPENAPI_STUB_DIR):
    print(
        f"Folder '{OPENAPI_STUB_DIR}' not found.  "
        "Please create the folder and extract zip file "
        "generated by openapi-generator into it."
    )
    sys.exit(1)

sys.path.append(OPENAPI_STUB_DIR)

try:
    import connexion
except ModuleNotFoundError:
    print(
        "Please install all required packages by running:"
        " pip install -r requirements.txt"
    )
    sys.exit(1)

from openapi_server import encoder


def create_app():
    app = connexion.App(__name__, specification_dir="./openapi/")
    app.app.json_encoder = encoder.JSONEncoder
    app.add_api(
        "ku-seek-api.yml",
        arguments={"title": "KU SEEK API"},
        pythonic_params=True,
    )
    return app

app = create_app()

if __name__ == "__main__":
    app.run(port=8000, debug=True, use_reloader=False)